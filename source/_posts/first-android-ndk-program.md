---
title: 第一个android studio+NDK程序
tags:
  - android
  - C++
  - JAVA
url: 1598.html
id: 1598
categories:
  - 软件开发
abbrlink: 20753
date: 2016-01-08 22:26:20
---

NDK(android native develop kits ):android 本地开发工具集 ,可以把c/c++ ->编译成一个 linux下可以执行的二进制文件 java代码里面就可以通过jni 调用执行二进制的文件。 什么是JNI ：java本地开发接口,JNI是一个协议这个协议用来沟通java代码和外部的本地代码(c/c++).通过这个协议,java代码就可以调用外部的c/c++，代码外部的c/c++代码也可以调用java代码。 java可以实现上层应用的开发，但是不能写底层驱动，有些android项目必须和底层硬件打交道，比如要精确快速的获取某种传感器的值，那么java是不能办到的，那怎么办，就通过JNI开发，通过c/c++完成底层驱动或者值得获取，然后将值传回到java层。同样java层也可以将数据传递给c/c++层，这样通过JNI完成数据的交互。 [![android_studio_NDK](http://baiyuan.wang/wp-content/uploads/2016/01/android_studio_NDK.jpg)](http://baiyuan.wang/wp-content/uploads/2016/01/android_studio_NDK.jpg) android\_studio\_NDK

为何要用到NDK?
---------

概括来说主要分为以下几种情况：

*   1\. 代码的保护，由于apk的java层代码很容易被反编译，而C/C++库反汇难度较大。
*   2\. 在NDK中调用第三方C/C++库，因为大部分的开源库都是用C/C++代码编写的。
*   3\. 便于移植，用C/C++写的库可以方便在其他的嵌入式平台上再次使用。

MainActivity:
-------------

package cn.wangbaiyuan.ndktest;

import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.widget.TextView;


public class MainActivity extends AppCompatActivity {

    public native String getStringFromNative();
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        System.loadLibrary("hello");
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
TextView hello=(TextView)findViewById(R.id.hello);
        hello.setText(getStringFromNative());
    }

}

下面是通过javah命令自动生成的

cn\_wangbaiyuan\_ndktest_MainActivity.h
---------------------------------------

/\* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/\* Header for class cn\_wangbaiyuan\_ndktest_MainActivity */

#ifndef \_Included\_cn\_wangbaiyuan\_ndktest_MainActivity
#define \_Included\_cn\_wangbaiyuan\_ndktest_MainActivity
#ifdef __cplusplus
extern "C" {
#endif
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_ABOVE\_CLIENT
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_ABOVE\_CLIENT 8L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_ADJUST\_WITH_ACTIVITY
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_ADJUST\_WITH_ACTIVITY 128L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_ALLOW\_OOM_MANAGEMENT
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_ALLOW\_OOM_MANAGEMENT 16L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_AUTO\_CREATE
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_AUTO\_CREATE 1L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_DEBUG\_UNBIND
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_DEBUG\_UNBIND 2L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND_IMPORTANT
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND_IMPORTANT 64L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_NOT\_FOREGROUND
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_NOT\_FOREGROUND 4L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_WAIVE\_PRIORITY
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_BIND\_WAIVE\_PRIORITY 32L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_CONTEXT\_IGNORE\_SECURITY
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_CONTEXT\_IGNORE\_SECURITY 2L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_CONTEXT\_INCLUDE\_CODE
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_CONTEXT\_INCLUDE\_CODE 1L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_CONTEXT_RESTRICTED
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_CONTEXT_RESTRICTED 4L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_MODE_APPEND
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_MODE_APPEND 32768L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_MODE\_ENABLE\_WRITE\_AHEAD\_LOGGING
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_MODE\_ENABLE\_WRITE\_AHEAD\_LOGGING 8L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_MODE\_MULTI\_PROCESS
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_MODE\_MULTI\_PROCESS 4L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_MODE_PRIVATE
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_MODE_PRIVATE 0L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_MODE\_WORLD\_READABLE
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_MODE\_WORLD\_READABLE 1L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_MODE\_WORLD\_WRITEABLE
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_MODE\_WORLD\_WRITEABLE 2L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_DEFAULT\_KEYS\_DIALER
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_DEFAULT\_KEYS\_DIALER 1L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_DEFAULT\_KEYS\_DISABLE
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_DEFAULT\_KEYS\_DISABLE 0L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_DEFAULT\_KEYS\_SEARCH_GLOBAL
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_DEFAULT\_KEYS\_SEARCH_GLOBAL 4L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_DEFAULT\_KEYS\_SEARCH_LOCAL
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_DEFAULT\_KEYS\_SEARCH_LOCAL 3L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_DEFAULT\_KEYS\_SHORTCUT
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_DEFAULT\_KEYS\_SHORTCUT 2L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_RESULT_CANCELED
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_RESULT_CANCELED 0L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_RESULT\_FIRST\_USER
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_RESULT\_FIRST\_USER 1L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_RESULT_OK
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_RESULT_OK -1L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_HONEYCOMB
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_HONEYCOMB 11L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_MSG\_REALLY\_STOPPED
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_MSG\_REALLY\_STOPPED 1L
#undef cn\_wangbaiyuan\_ndktest\_MainActivity\_MSG\_RESUME\_PENDING
#define cn\_wangbaiyuan\_ndktest\_MainActivity\_MSG\_RESUME\_PENDING 2L
/\*
 \* Class:     cn\_wangbaiyuan\_ndktest_MainActivity
 \* Method:    getStringFromNative
 \* Signature: ()Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java\_cn\_wangbaiyuan\_ndktest\_MainActivity_getStringFromNative
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif

  在build.gradle（Module:App）加入下列配置可指定生成.so文件的CPU平台类型以及so文件的名称，如果没有指定，android将会生成libapp.so，以及所有平台的so文件；生成so文件路径为：**你的项目根目录\\app\\build\\intermediates\\ndk\\debug\\lib**

build.gradle（Module:App）
------------------------

    defaultConfig {
        ndk {
            moduleName "hello"
            ldLibs "log", "z", "m"
            abiFilters "armeabi", "armeabi-v7a", "x86"
        }
      …………
        }